<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        *{
            margin: 0;
            padding: 0
        }
        #canvas{
            background: green;
        }
        #tool{
            position: absolute;
            bottom:20px ;
            left: 0;

        }
        #tool-ct{
            position: relative
        }
    </style>
</head>
<body>
    <canvas id="canvas" width='500' height='500'>
    </canvas>
    <div id="tool-ct">
        <div id="tool">
            <button id="erase">橡皮</button>
            <button id='pen'>画笔</button>
        </div>
    </div>




    <script>
        //这两句固定
        var canvas  = document.getElementById('canvas')
        var context = canvas.getContext('2d')

        //
        var width = document.documentElement.clientWidth 
        var height = document.documentElement.clientHeight
        var usErase = false
        var usPen = true


        //实时获取用户的视口宽度和高度,让canvas铺满全整个视口
        window.onload = function(){
            getViewWidHei()
        }
        getViewWidHei()




        erase.onclick = function(){
            usErase = true
        }
        pen.onclick = function(){
            usErase = false
        }



        //模拟用户涂鸦过程
        //1. 要监听用户在 canvas 中鼠标是否点击,表示画图开始
        //drwa是状态锁
        var usingTool = false;
        canvas.onmousedown = function(aaa){
            usingTool = true;
            var x = aaa.clientX-5
            var y = aaa.clientY-5
            firstPoint = {
                'x': x,
                'y': y
            }
            if(usErase){
                usingErase(x,y)
            } else {
                drawCircle(x,y)
            }
            
        }


        //2. 要监听用户在 canvas 中鼠标是否移动,表示持续画图
        canvas.onmousemove = function(aaa){
            if(usingTool){ 
                var x = aaa.clientX-5
                var y = aaa.clientY-5
                var secondPoint = {
                    'x': x,
                    'y': y
                }
                if(usErase){
                    usingErase(x,y)
                    firstPoint = secondPoint
                } else {
                    drawCircle(x,y)
                    drawLine(firstPoint.x, firstPoint.y, secondPoint.x, secondPoint.y)
                    firstPoint = secondPoint
                }
            }

        }

        //3. 要监听用户在 canvas 中鼠标是否释放,表示结束画图
        canvas.onmouseup = function(){
            usingTool = false
        }




        //封装函数
        //给定两个坐标,可以画线
        function drawLine(x1,y1,x2,y2){
            context.beginPath();
            context.strokeStyle = "blue"
            context.lineWidth=10;
            context.moveTo(x1,y1);
            context.lineTo(x2,y2);
            context.closePath();
            context.stroke();
        }
        //画圆
        function drawCircle (x,y){
            context.beginPath();
            context.fillStyle = "blue"
            context.arc(x,y,4,0,Math.PI*2,true);
            context.closePath();
            context.fill();   
        }

        function usingErase(x,y){
            context.clearRect(x, y, 20,20)
        }

        function getViewWidHei(){
            canvas.width = width
            canvas.height = height
        }

    </script>    
</body>
</html>